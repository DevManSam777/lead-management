<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevLeads Login</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --text-color: #333;
            --background-color: #f4f4f9;
            --card-background: #ffffff;
            --error-color: #f72585;
            --border-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.08);
            --success-color: #4caf50;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--background-color);
            padding: 20px;
        }
        
        .login-container {
            background: var(--card-background);
            padding: 40px 30px;
            border-radius: 8px;
            box-shadow: 0 4px 20px var(--shadow-color);
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .login-logo svg {
            width: 40px;
            height: 40px;
            fill: var(--primary-color);
        }
        
        .login-container h1 {
            margin-bottom: 25px;
            font-size: 1.8rem;
            text-align: center;
            color: var(--text-color);
            position: relative;
        }
        
        .login-container h1::after {
            content: "";
            display: block;
            width: 80px;
            height: 3px;
            background-color: var(--primary-color);
            margin: 10px auto 0;
            border-radius: 2px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }
        
        .input-with-icon {
            position: relative;
        }
        
        .input-with-icon input {
            width: 100%;
            padding: 12px 12px 12px 40px;
            font-size: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            transition: border-color 0.2s;
        }
        
        .input-with-icon input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .input-with-icon svg {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            fill: #999;
        }
        
        .login-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 10px;
        }
        
        .login-btn:hover {
            background-color: #3f37c9;
        }
        
        .error-message {
            color: var(--error-color);
            font-size: 0.875rem;
            margin-bottom: 15px;
            text-align: center;
            padding: 10px;
            border-radius: 5px;
            background-color: rgba(247, 37, 133, 0.08);
            display: none;
        }
        
        .forgot-password {
            display: block;
            text-align: right;
            margin-top: 10px;
            margin-bottom: 20px;
            font-size: 0.875rem;
            color: var(--primary-color);
            text-decoration: none;
            cursor: pointer;
        }
        
        .forgot-password:hover {
            text-decoration: underline;
        }
        
        .shake {
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        /* Modal styles for password reset */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: var(--card-background);
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        
        .close-modal:hover {
            color: var(--text-color);
        }
        
        .modal h2 {
            margin-bottom: 20px;
            font-size: 1.5rem;
            color: var(--text-color);
            text-align: center;
        }
        
        .modal p {
            margin-bottom: 20px;
            color: var(--text-color);
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        /* Email display for reset confirmation */
        .email-display {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
            margin: 20px 0;
            background-color: #f9f9f9;
            border: 1px solid var(--border-color);
            border-radius: 5px;
        }
        
        .email-icon {
            margin-right: 10px;
            color: #666;
        }
        
        .confirmation-message {
            color: var(--success-color);
            font-size: 0.95rem;
            text-align: center;
            margin: 20px 0;
            line-height: 1.5;
        }
        
        /* Responsive styles */
        @media (max-width: 480px) {
            .login-container {
                padding: 30px 20px;
            }
            
            .input-with-icon input {
                padding: 10px 10px 10px 36px;
            }
            
            .login-btn {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-logo">
            <!-- Chart icon SVG -->
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M3 13h2v7H3zm4-7h2v14H7zm4-6h2v20h-2zm4 11h2v9h-2zm4-5h2v14h-2z"/>
            </svg>
        </div>
        <h1>DevLeads Login</h1>
        <form id="loginForm">
            <div class="form-group">
                <label for="email">Email</label>
                <div class="input-with-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                    </svg>
                    <input type="email" id="email" placeholder="Enter your email" required>
                </div>
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <div class="input-with-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
                    </svg>
                    <input type="password" id="password" placeholder="Enter your password" required>
                </div>
                <a class="forgot-password" id="forgotPasswordLink">Forgot password?</a>
            </div>
            <div class="error-message" id="errorMessage"></div>
            <button type="submit" class="login-btn">Sign In</button>
        </form>
    </div>
    
    <!-- Password Reset Modal -->
    <div id="resetPasswordModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeResetModal">&times;</span>
            <!-- Reset Form Container -->
            <div id="resetFormContainer">
                <h2>Reset Password</h2>
                <p>Enter your email address and we'll send you a link to reset your password.</p>
                <form id="resetPasswordForm">
                    <div class="form-group">
                        <label for="resetEmail">Email Address</label>
                        <div class="input-with-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                            </svg>
                            <input type="email" id="resetEmail" placeholder="Enter your email" required>
                        </div>
                    </div>
                    <div class="error-message" id="resetErrorMessage"></div>
                    <button type="submit" class="login-btn" id="resetPasswordBtn">Send Reset Link</button>
                </form>
            </div>
            
            <!-- Reset Confirmation Container -->
            <div id="resetConfirmationContainer" style="display:none; text-align:center;">
                <h2>Reset Password</h2>
                <div class="email-display">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width: 20px; height: 20px; fill: #666; margin-right: 8px;">
                        <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                    </svg>
                    <span id="confirmedEmail"></span>
                </div>
                <p class="confirmation-message">Password reset email sent! Check your inbox for instructions.</p>
            </div>
        </div>
    </div>
    
    <script type="module">
        // Import Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, sendPasswordResetEmail, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCtxxEU1DGzGJO83lquD4biAjPlRFMzq4E",
            authDomain: "devleads-a1329.firebaseapp.com",
            projectId: "devleads-a1329",
            storageBucket: "devleads-a1329.firebasestorage.app",
            messagingSenderId: "95407568917",
            appId: "1:95407568917:web:db6424b8f1df724258361c",
            measurementId: "G-47PSY58Q5P"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // Handle login form submission
        const loginForm = document.getElementById('loginForm');
        const errorMessage = document.getElementById('errorMessage');
        const loginContainer = document.querySelector('.login-container');

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Clear previous error messages
            errorMessage.style.display = 'none';
            
            // Show loading state
            const submitBtn = loginForm.querySelector('.login-btn');
            const originalButtonText = submitBtn.textContent;
            submitBtn.textContent = 'Signing In...';
            submitBtn.disabled = true;

            signInWithEmailAndPassword(auth, email, password)
                .then(() => {
                    // Redirect to dashboard
                    window.location.href = 'html/dashboard.html';
                })
                .catch((error) => {
                    // Reset button
                    submitBtn.textContent = originalButtonText;
                    submitBtn.disabled = false;
                    
                    // Show error with animation
                    errorMessage.textContent = getErrorMessage(error.code);
                    errorMessage.style.display = 'block';
                    loginContainer.classList.add('shake');
                    
                    // Remove animation class after it completes
                    setTimeout(() => {
                        loginContainer.classList.remove('shake');
                    }, 500);
                });
        });

        // Password Reset Modal
        const resetModal = document.getElementById('resetPasswordModal');
        const forgotPasswordLink = document.getElementById('forgotPasswordLink');
        const closeResetModal = document.getElementById('closeResetModal');
        const resetPasswordForm = document.getElementById('resetPasswordForm');
        const resetErrorMessage = document.getElementById('resetErrorMessage');
        const resetFormContainer = document.getElementById('resetFormContainer');
        const resetConfirmationContainer = document.getElementById('resetConfirmationContainer');
        const confirmedEmail = document.getElementById('confirmedEmail');

        // Show reset password modal
        forgotPasswordLink.addEventListener('click', () => {
            resetModal.style.display = 'flex';
            document.getElementById('resetEmail').value = document.getElementById('email').value;
            resetErrorMessage.style.display = 'none';
            resetFormContainer.style.display = 'block';
            resetConfirmationContainer.style.display = 'none';
        });

        // Close reset password modal
        closeResetModal.addEventListener('click', () => {
            resetModal.style.display = 'none';
        });

        // Close modal when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target === resetModal) {
                resetModal.style.display = 'none';
            }
        });

        // Handle password reset form submission
        resetPasswordForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('resetEmail').value;
            
            // Reset error messages
            resetErrorMessage.style.display = 'none';
            
            // Show loading state
            const resetBtn = resetPasswordForm.querySelector('.login-btn');
            const originalButtonText = resetBtn.textContent;
            resetBtn.textContent = 'Sending...';
            resetBtn.disabled = true;

            // Send password reset email
            sendPasswordResetEmail(auth, email)
                .then(() => {
                    // Show success confirmation and hide form
                    resetFormContainer.style.display = 'none';
                    confirmedEmail.textContent = email;
                    resetConfirmationContainer.style.display = 'block';
                    
                    // Close modal after a delay
                    setTimeout(() => {
                        resetModal.style.display = 'none';
                    }, 3000);
                })
                .catch((error) => {
                    // Show error message
                    resetErrorMessage.textContent = getErrorMessage(error.code);
                    resetErrorMessage.style.display = 'block';
                    resetBtn.textContent = originalButtonText;
                    resetBtn.disabled = false;
                });
        });

        // Function to get user-friendly error messages
        function getErrorMessage(errorCode) {
            switch(errorCode) {
                case 'auth/invalid-email':
                    return 'Please enter a valid email address';
                case 'auth/user-disabled':
                    return 'This account has been disabled';
                case 'auth/user-not-found':
                    return 'No account found with this email';
                case 'auth/wrong-password':
                    return 'Incorrect password';
                case 'auth/too-many-requests':
                    return 'Too many failed login attempts. Please try again later';
                case 'auth/missing-password':
                    return 'Please enter your password';
                default:
                    return 'Failed to sign in. Please check your credentials';
            }
        }

        // Redirect to dashboard if already logged in
        onAuthStateChanged(auth, (user) => {
            if (user) {
                window.location.href = 'html/dashboard.html';
            }
        });
    </script>
</body>
</html>